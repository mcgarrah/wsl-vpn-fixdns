# Command to Fix DNS under WSL when running a VPN connection

This is a quick script to fix for your DNS when running WSL from a VPN connection.

## Install Script

```
$ git clone https://github.com/mcgarrah/wsl-vpn-fixdns
$ cd wsl-vpn-fixdns
$ sudo cp fixdns /usr/local/bin
$ sudo chmod +x /usr/local/bin/fixdns
```

## Running Script

```
$ fixdns
[sudo] password: *********
Current resolv.conf
-------------------
# This file was automatically generated by WSL. To stop automatic generation of this file, remove this line.
nameserver 192.168.1.254
nameserver 10.10.10.5
nameserver 10.10.20.5
search attlocal.net

Creating new resolv.conf
------------------------
# This file was automatically generated by WSL. To stop automatic generation of this file, remove this line.
nameserver 10.10.10.5
nameserver 10.10.20.5
nameserver 192.168.1.254
nameserver 192.168.86.1
nameserver 192.168.1.254
search attlocal.net
+ sudo cp -i /tmp/tmp.I3f660fyr0 /etc/resolv.conf
```

## Shell Code

I borrowed the code almost whole cloth from the comment at https://github.com/microsoft/WSL/issues/1350#issuecomment-427924074 by https://github.com/nfekete for WSL. I did add a check for running as root and force sudo execution. There were other solutions on that issue but this one worked for me.

The code depends on PowerShell.

## Errata

There is sure to be something added here shortly.
